name: test-docs

on: [push, pull_request, workflow_dispatch]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  main:
    name: test-docs ${{ matrix.document.name }} ${{ matrix.image.name }} ${{ matrix.image.name }}
    runs-on: ubuntu-latest
    steps:
      - run: sudo apt -o Acquire::Retries=3 update
      - run: sudo apt -o Acquire::Retries=3 install -y musl-tools
      - uses: actions/checkout@v3
      - run: helper/md-test.sh --images="${{ matrix.image.name }}" --context="${{ matrix.image.name }}" --document="${{ matrix.document.name }}" --mode="basic"
        shell: bash
    strategy:
      fail-fast: false
      matrix:
        images:
          - name: ubuntu
          - name: debian
          - name: fedora
          - name: centos7
          - name: centos8
        contexts:
          - name: "git,helloworld"
          - name: "crates,helloworld"
        document:
          - name: "README.md"
